■Muninの処理をfastcgiに任せる
1. 情報源
★デフォルトではcron設定となっており、5分毎にグラフが生成される。
★cron設定からcgi設定に変更することにより動的なグラフ生成を可能とすることでパフォーマンスの向上を目的とする。
★Munin公式：http://munin-monitoring.org/wiki/MuninConfigurationMasterCGI
★環境：Debina 8

2. fast-cgiのインストール
★fast-cgiをインストールする
# apt-get install spawn-fcgi

★起動テスト
spawn-fcgi -s /var/run/munin/fcgi-graph.sock -U www-data -u www-data -g www-data /usr/lib/munin/cgi/munin-cgi-graph
spawn-fcgi -s /var/run/munin/fcgi-html.sock -U www-data -u www-data -g munin  /usr/lib/munin/cgi/munin-cgi-html

★起動スクリプトの登録
# vi /etc/init.d/munin-fast-cgi-graph
# vi /etc/init.d/munin-fast-cgi-html
munin-fast-cgi-graph.txt , munin-fast-cgi-html.txt 参照(公式改変版)

★自動起動登録
★自動起動設定ツールをインストール(本来systemdを利用すべき)
# apt-get install chkconfig 

★自動起動登録
# chkconfig munin-fast-cgi-graph on
# chkconfig munin-fast-cgi-html on

2. munin.confの変更
★モードの変更を行う
# vi /etc/munin/munin.conf

#graph_strategy cron
graph_strategy cgi

#html_strategy cron
html_strategy cgi

★確認
# chkconfig --list | grep -e munin-fast-cgi-graph -e munin-fast-cgi-html

■nginxの設定
1. fast-cgiを呼び出す様に変更(公式参照)
# vi /etc/nginx/sites-available/munin.http
# vi /etc/nginx/sites-available/munin.ssh

■バグ修正(自環境限定)
★nginxのログを参照し、No such file.等のエラーを消していく。
★pngファイルの参照先が/var/cache/munin/www/usr/lib/munin/cgi/munin-cgi-graphとなっていたので、一時しのぎで変更
# mkdir -p /usr/share/nginx/html/munin-cgi
# ln -s munin-cgi /var/cache/munin/www/

